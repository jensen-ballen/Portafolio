<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <meta name="description" content="Portfolio Viewer Seguro - Visualizaci贸n profesional y protegida del portafolio de Jensen Ballen" />
    <meta name="author" content="Jensen Ballen" />
    <meta name="theme-color" content="#2563eb" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Portfolio Viewer" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    <meta name="msapplication-config" content="browserconfig.xml" />

    <title>Portfolio Viewer Seguro - Jensen Ballen</title>
    <base href="/" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />

    <!-- Favicon and Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png" />

    <!-- Styles -->
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link href="PortfolioViewer.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        Error inesperado en la aplicaci贸n.
        <a href="" class="reload">Recargar</a>
        <a class="dismiss"></a>
    </div>

    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(function(registration) {
                    console.log('[PWA] Service Worker registrado correctamente:', registration.scope);

                    // Manejar actualizaciones del service worker
                    registration.addEventListener('updatefound', function() {
                        const newWorker = registration.installing;
                        if (newWorker) {
                            newWorker.addEventListener('statechange', function() {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versi贸n disponible
                                    if (confirm('Nueva versi贸n disponible. 驴Deseas actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        }
                    });
                })
                .catch(function(error) {
                    console.log('[PWA] Error al registrar Service Worker:', error);
                });
        }

        // Detectar si estamos en modo standalone (PWA)
        if (window.matchMedia('(display-mode: standalone)').matches ||
            window.navigator.standalone === true) {
            console.log('[PWA] Ejecut谩ndose en modo standalone');
            document.body.classList.add('pwa-mode');
        }

        // Prevenir zoom en iOS cuando hay doble tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Mejorar experiencia t谩ctil
        document.addEventListener('touchstart', function() {}, { passive: true });
    </script>

    <script src="_framework/blazor.webassembly.js"></script>
</body>

</html>
